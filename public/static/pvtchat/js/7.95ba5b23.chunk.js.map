{"version":3,"sources":["containers/SiteMain/MainContent/Main/ChatInput/VideoRec/VideoRec.js"],"names":["videoRef","React","createRef","VideoCam","state","start","mediaRecorder","id","_this","props","match","params","categ","stopRecHandler","webCameraApi","socket","video","audio","then","media","setState","onUploadMedia","history","goBack","catch","err","_this2","this","current","srcObject","stream","getTracks","forEach","track","stop","cnt","react__WEBPACK_IMPORTED_MODULE_4___default","a","createElement","_components_UI_Loader_Loader__WEBPACK_IMPORTED_MODULE_11__","bg","onTypingErr","className","ref","autoPlay","onClick","disabled","_fortawesome_react_fontawesome__WEBPACK_IMPORTED_MODULE_5__","icon","Component","withRouter","connect","vidRecBackdrop","dispatch","actions"],"mappings":"iOAUIA,EAAWC,IAAMC,UAAU,MACzBC,8MACFC,MAAQ,CACJC,OAAO,EACPC,cAAe,KACfC,GAAIC,EAAKC,MAAMC,MAAMC,OAAOJ,GAC5BK,MAAOJ,EAAKC,MAAMC,MAAMC,OAAOC,SAoBnCC,eAAiB,WACbC,YAAaC,IAAQP,EAAKJ,MAAME,cAAeE,EAAKJ,MAAMC,MAAO,CAACW,OAAO,EAAMC,OAAO,GAClF,YAAa,MAAM,QAAS,mBAAmBC,KAAK,SAAAC,GACpDX,EAAKY,SAAS,CAACd,cAAe,KAAMD,OAAO,IAC3CG,EAAKC,MAAMY,cAAcF,EAAOX,EAAKJ,MAAMG,GAAIC,EAAKJ,MAAMQ,OAC1DJ,EAAKC,MAAMa,QAAQC,WACpBC,MAAM,SAAAC,GACLjB,EAAKY,SAAS,CAACf,OAAO,yEAxBV,IAAAqB,EAAAC,KAChBb,YAAaC,IAAQY,KAAKvB,MAAME,cAAeqB,KAAKvB,MAAMC,MAAO,CAACW,OAAO,EAAMC,OAAO,GAClF,YAAa,MAAM,QAAS,mBAAmBC,KAAK,SAAAC,GACxDnB,EAAS4B,QAAQC,UAAYV,EAAMW,OACnCJ,EAAKN,SAAS,CAACd,cAAea,EAAMb,cAAeD,OAAO,MACvDmB,MAAM,SAAAC,GACLC,EAAKN,SAAS,CAACf,OAAO,qDAKtBsB,KAAKvB,MAAME,eACXqB,KAAKvB,MAAME,cAAcwB,OAAOC,YAAYC,QAAS,SAAAC,GAAK,OACtDA,EAAMC,0CAgBd,IAAIC,EAAMC,EAAAC,EAAAC,cAACC,EAAA,EAAD,CACVC,IAAE,IAUF,OARIb,KAAKvB,MAAMC,QACX8B,EAAM,MAGNR,KAAKvB,MAAMqB,KACXE,KAAKlB,MAAMgC,YAAYd,KAAKvB,MAAMqB,KAItCW,EAAAC,EAAAC,cAAA,OAAKI,UAAU,2BACXN,EAAAC,EAAAC,cAAA,OAAKI,UAAU,oCACVP,EACDC,EAAAC,EAAAC,cAAA,SACIK,IAAK3C,EACL4C,UAAQ,EACRF,UAAU,2CACVN,EAAAC,EAAAC,cAAA,yDAEJF,EAAAC,EAAAC,cAAA,UACIO,QAASlB,KAAKd,eACd6B,UAAU,mCACVI,UAAWnB,KAAKvB,MAAMC,OACtB+B,EAAAC,EAAAC,cAACS,EAAA,EAAD,CAAiBC,KAAM,CAAC,MAAO,qBA9D5BC,aAmFRC,sBAAWC,YAbF,SAAA/C,GACpB,MAAO,CACHgD,eAAgBhD,EAAM+B,IAAIiB,iBAIP,SAAAC,GACvB,MAAO,CACHZ,YAAa,SAAChB,GAAD,OAAS4B,EAASC,IAAqB7B,KACpDJ,cAAe,SAACc,EAAK5B,EAAIK,GAAV,OAAoByC,EAASC,KAAwBnB,EAAK5B,EAAIK,OAI3DuC,CAA6ChD","file":"static/js/7.95ba5b23.chunk.js","sourcesContent":["import React, { Component } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { connect } from 'react-redux';\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nimport './VideoRec.css';\r\nimport { socket, webCameraApi } from '../../../../../../shared/utility';\r\nimport * as actions from '../../../../../../store/actions/index';\r\nimport Loader from '../../../../../../components/UI/Loader/Loader';\r\n\r\nlet videoRef = React.createRef(null);\r\nclass VideoCam extends Component {\r\n    state = {\r\n        start: false,\r\n        mediaRecorder: null,\r\n        id: this.props.match.params.id,\r\n        categ: this.props.match.params.categ,\r\n    };\r\n\r\n    componentDidMount() {\r\n        webCameraApi(socket, this.state.mediaRecorder, this.state.start, {video: true, audio: true}, \r\n            'video/mp4', 'mp4','media', 'pvtMediaRecChat').then(media => {\r\n        videoRef.current.srcObject = media.stream\r\n        this.setState({mediaRecorder: media.mediaRecorder, start: true})\r\n        }).catch(err => {\r\n            this.setState({start: false})\r\n        })\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.state.mediaRecorder) {\r\n            this.state.mediaRecorder.stream.getTracks().forEach( track => \r\n                track.stop())\r\n        }\r\n    }\r\n\r\n    stopRecHandler = () => {\r\n        webCameraApi(socket, this.state.mediaRecorder, this.state.start, {video: true, audio: true}, \r\n            'video/mp4', 'mp4','media', 'pvtMediaRecChat').then(media => {\r\n            this.setState({mediaRecorder: null, start: false})\r\n            this.props.onUploadMedia(media, this.state.id, this.state.categ)\r\n            this.props.history.goBack();\r\n        }).catch(err => {\r\n            this.setState({start: false})\r\n        })\r\n    }\r\n\r\n    render() {\r\n        let cnt = <Loader \r\n        bg/>\r\n\r\n        if (this.state.start) {\r\n            cnt = null\r\n        }\r\n\r\n        if (this.state.err) {\r\n            this.props.onTypingErr(this.state.err)\r\n        }\r\n\r\n        return(\r\n        <div className=\"site-main__chat--vidcam\">\r\n            <div className=\"site-main__chat--vidcam__wrapper\">\r\n                {cnt }\r\n                <video \r\n                    ref={videoRef}\r\n                    autoPlay\r\n                    className=\"site-main__chat--vidcam__video--wrapper\">\r\n                    <p>our browser doesn't support embedded videos</p>\r\n                </video>\r\n                <button \r\n                    onClick={this.stopRecHandler}\r\n                    className=\"site-main__chat--vidcam__control\"\r\n                    disabled={!this.state.start}>\r\n                    <FontAwesomeIcon icon={['fas', 'video']} />\r\n                </button>\r\n            </div>\r\n        </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        vidRecBackdrop: state.cnt.vidRecBackdrop\r\n    };\r\n }\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n        onTypingErr: (err) => dispatch(actions.fetchCntFail(err)),\r\n        onUploadMedia: (cnt, id, categ) => dispatch(actions.uploadMediaInit(cnt, id, categ))\r\n    };\r\n};\r\n\r\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(VideoCam)); "],"sourceRoot":""}