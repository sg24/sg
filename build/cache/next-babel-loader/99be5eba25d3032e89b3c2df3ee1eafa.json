{"ast":null,"code":"import * as actions from '../../store/actions/index';\nimport axios from '../../axios';\nexport const submit = formData => {\n  return dispatch => {\n    dispatch(actions.submitFormStart());\n    let formContent = new FormData();\n\n    for (let key in formData) {\n      if (key !== 'video' && key !== 'image' && key !== 'removedSnap' && key !== 'snapshot') {\n        formContent.append(key, formData[key]);\n      }\n\n      if (key === 'video') {\n        for (let video of formData[key]) {\n          let ext = video.file.type.split('/').pop();\n          formContent.append(key, video.file, `${video.id}.${ext}`);\n        }\n      }\n\n      if (key === 'image') {\n        let send = 0;\n        let uploaded = [];\n\n        for (let image of formData[key]) {\n          if (image.mediaType) {\n            uploaded.push({\n              id: image.id,\n              filename: image.filename,\n              type: image.type\n            });\n            ++send;\n\n            if (send === formData[key].length) {\n              formContent.append('uploadedimage', JSON.stringify(uploaded));\n            }\n          } else {\n            let ext = image.file.type.split('/').pop();\n            formContent.append(key, image.file, `${image.id}.${ext}`);\n            ++send;\n\n            if (send === formData[key].length) {\n              formContent.append('uploadedimage', JSON.stringify(uploaded));\n            }\n          }\n        }\n      }\n\n      if (key === 'snapshot') {\n        let uploadedSnap = [];\n        let uploadedVideo = [];\n\n        for (let media of formData[key]) {\n          uploadedSnap.push({\n            id: media.id,\n            videoID: media.videoID,\n            videoCnt: media.videoCnt\n          });\n          uploadedVideo.push({\n            id: media.video.id,\n            snapshotID: media.video.snapshotID,\n            type: media.video.type\n          });\n        }\n\n        formContent.append('uploadedvideo', JSON.stringify(uploadedVideo));\n        formContent.append('uploadedsnap', JSON.stringify(uploadedSnap));\n      }\n\n      if (key === 'removedSnap' && formData[key].length > 0) {\n        formContent.append('removedmedia', JSON.stringify(formData[key]));\n      }\n    }\n\n    axios.post('/edit/post', formContent, {\n      onUploadProgress: function (progressEvent) {\n        if (progressEvent.lengthComputable) {\n          const percentage = Math.round(progressEvent.loaded * 100 / progressEvent.total);\n          dispatch(actions.submitFormSuccess(percentage));\n        }\n      }\n    }).then(res => {\n      dispatch(actions.formSubmitted(res.data));\n    }).catch(err => {\n      dispatch(actions.submitFormFail(err));\n    });\n  };\n};","map":null,"metadata":{},"sourceType":"module"}