{"ast":null,"code":"import axios from '../../../axios';\nlet publickey = false ? document.cookie.replace(/(?:(?:^|.*;\\s*)pushMsg\\s*\\=\\s*([^;]*).*$)|^.*$/, \"$1\") : null;\n\nfunction displayConfirmNotification() {\n  return new Promise((resolve, reject) => {\n    if ('serviceWorker' in navigator) {\n      var options = {\n        body: 'You successfully subscribed to Slodge24 Notification service!',\n        icon: '/icons/sg-icon-96x96.png',\n        dir: 'ltr',\n        lang: 'en-US',\n        vibrate: [200, 100, 200, 100, 200, 100, 200],\n        requireInteraction: true,\n        badge: '/icons/sg-icon-96x96.png',\n        tag: 'confirm-notification',\n        renotify: true,\n        actions: [{\n          action: 'confirm',\n          title: 'Okay'\n        }, {\n          action: 'cancel',\n          title: 'Cancel'\n        }]\n      };\n      navigator.serviceWorker.ready.then(function (swreg) {\n        swreg.showNotification('Successfully subscribed!', options);\n        resolve();\n      });\n    } else {\n      reject();\n    }\n  });\n}\n\nfunction configurePushSub() {\n  return new Promise((resolve, reject) => {\n    if (!('serviceWorker' in navigator)) {\n      return;\n    }\n\n    var reg;\n    navigator.serviceWorker.ready.then(function (swreg) {\n      reg = swreg;\n      return swreg.pushManager.getSubscription();\n    }).then(function (sub) {\n      if (sub === null) {\n        let vapidPublicKey = publickey;\n        let convertedVapidPublicKey = urlBase64ToUint8Array(vapidPublicKey);\n        return reg.pushManager.subscribe({\n          userVisibleOnly: true,\n          applicationServerKey: convertedVapidPublicKey\n        });\n      } else {\n        return sub;\n      }\n    }).then(function (newSub) {\n      let sub = JSON.stringify(newSub);\n      return axios.post('/users', null, {\n        headers: {\n          'data-categ': `subscribe==${sub}`\n        }\n      });\n    }).then(function (res) {\n      if (res.status === 200) {\n        displayConfirmNotification().then(() => {\n          resolve();\n        });\n      }\n    }).catch(function (err) {\n      reject(err);\n    });\n  });\n}\n\nexport function requestPermission() {\n  return new Promise((resolve, reject) => {\n    Notification.requestPermission(function (result) {\n      if (result !== 'granted') {\n        reject(result);\n      } else {\n        configurePushSub().then(() => {\n          resolve();\n        });\n      }\n    });\n  });\n}\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}","map":null,"metadata":{},"sourceType":"module"}